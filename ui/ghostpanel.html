<div id="the_ghost_face_control_panel">
    <!-- 控制面板 -->
    <div id="the_ghost_face_control_panel_content" class="ghost-theme-responsive">

        <!-- 头部 -->
        <div id="the_ghost_face_control_panel_header">
            <h3 style="margin: 0; -size: 18px; -weight: 600;">
                👻 鬼面控制台
            </h3>
            <div style="display: flex; gap: 8px;">
                <button id="the_ghost_face_guide_btn" class="ghost-button"
                    style="padding: 4px 8px; min-height: 28px; font-size: 12px;">
                    使用说明
                </button>
                <button id="the_ghost_face_user_profile" class="ghost-button"
                    style="padding: 4px 8px; min-height: 28px; font-size: 12px;">
                    👤 未登录
                </button>
            </div>
        </div>

        <!-- 可滚动的主体内容 -->
        <div class="ghost-panel-body">

            <div class="ghost-main-actions-vertical">
                <!-- 自动开关按钮 -->
                <button id="the_ghost_face_control_panel_toggle_auto" class="ghost-button ghost-auto-toggle"
                    data-auto-enabled="false">
                    自动OFF
                </button>

                <!-- 设置菜单按钮 -->
                <button id="the_ghost_face_control_panel_settings_toggle" class="ghost-button ghost-panel-toggle">
                    设置菜单
                </button>
                <!-- 朋友圈按钮 -->
                <button id="the_ghost_face_moments_btn" class="ghost-button ghost-panel-toggle">
                    朋友圈
                </button>

                <!-- 世界书管理按钮 -->
                <button id="gf_tab_worldbook_manager" class="ghost-button ghost-panel-toggle">
                    世界书管理
                </button>
            </div>

            <!-- 世界书管理面板 -->
            <div id="ghostface_worldbook_manager_panel" style="display: none; margin-bottom: 20px;">
                <div class="ghost-settings-card" id="ghostface_worldbook_manager_content">
                </div>
            </div>


            <!-- 可折叠的设置区域 -->
            <div id="the_ghost_face_control_panel_settings_area" style="display: none; margin-bottom: 20px;">

                <div class="ghost-toggle-group">
                    <div id="the_ghost_face_custom_wb_container"
                        style="margin-top: 5px; margin-bottom: 10px; padding-left: 5px;">
                        <label
                            style="color: var(--SmartThemeBodyColor); font-size: 13px; margin-bottom: 4px; display: block;">
                            为当前角色指定世界书
                        </label>
                        <select id="the_ghost_face_custom_wb_select" class="ghost-select"
                            style="font-size: 13px; padding: 6px 8px; width: 100%;">
                            <option value="">未选择</option>
                        </select>
                    </div>
                    <label class="ghost-toggle-row" for="the_ghost_face_auto_hide_after_sum">
                        <span class="ghost-toggle-label">总结后自动隐藏楼层</span>
                        <div class="ghost-toggle-switch">
                            <input type="checkbox" id="the_ghost_face_auto_hide_after_sum" checked>
                            <span class="ghost-toggle-slider"></span>
                        </div>
                    </label>
                    <label class="ghost-toggle-row" for="the_ghost_face_control_panel_use_custom_api_checkbox">
                        <span class="ghost-toggle-label">鬼面自定义API</span>
                        <div class="ghost-toggle-switch">
                            <input type="checkbox" id="the_ghost_face_control_panel_use_custom_api_checkbox">
                            <span class="ghost-toggle-slider"></span>
                        </div>
                    </label>
                    <label class="ghost-toggle-row" for="the_ghost_face_control_panel_moment_custom_api_checkbox">
                        <span class="ghost-toggle-label">朋友圈自定义API</span>
                        <div class="ghost-toggle-switch">
                            <input type="checkbox" id="the_ghost_face_control_panel_moment_custom_api_checkbox">
                            <span class="ghost-toggle-slider"></span>
                        </div>
                    </label>
                    <label class="ghost-toggle-row" for="the_ghost_face_control_panel_show_float_bubble_checkbox">
                        <span class="ghost-toggle-label">显示朋友圈悬浮泡泡</span>
                        <div class="ghost-toggle-switch">
                            <input type="checkbox" id="the_ghost_face_control_panel_show_float_bubble_checkbox" checked>
                            <span class="ghost-toggle-slider"></span>
                        </div>
                    </label>
                </div>
                <!-- 触发设置 -->
                <div style="margin-bottom: 15px;">
                    <label
                        style="color: var(--SmartThemeBodyColor); font-size: 12px; margin-bottom: 8px; display: block;">
                        触发设置
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div>
                            <label style="color: var(--SmartThemeBodyColor); font-size: 12px;">Token阈值</label>
                            <input id="the_ghost_face_token_threshold" type="number" min="40000" max="8000000"
                                value="100000" class="ghost-input">
                        </div>
                        <div>
                            <label style="color: var(--SmartThemeBodyColor); font-size: 12px;">消息阈值(条)</label>
                            <input id="the_ghost_face_control_panel_interval_input" type="number" min="0" max="250"
                                value="50" class="ghost-input">
                        </div>
                    </div>
                </div>


                <!-- 指定范围总结 -->
                <div style="margin-bottom: 15px;">
                    <label
                        style="color: var(--SmartThemeBodyColor); font-size: 12px; margin-bottom: 8px; display: block;">
                        指定范围总结
                    </label>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div>
                            <label style="color: var(--SmartThemeBodyColor); font-size: 12px;">起始楼层</label>
                            <input id="the_ghost_face_control_panel_manual_start" type="number" min="1" value="1"
                                class="ghost-input" placeholder="开始">
                        </div>
                        <div>
                            <label style="color: var(--SmartThemeBodyColor); font-size: 12px;">结束楼层</label>
                            <input id="the_ghost_face_control_panel_manual_end" type="number" min="1" value=""
                                class="ghost-input" placeholder="结束">
                        </div>
                    </div>

                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-top: 10px;">
                        <button id="the_ghost_face_control_panel_big_summary_range" class="ghost-button ghost-primary">
                            开始大总结
                        </button>
                        <button id="the_ghost_face_control_panel_hide_range" class="ghost-button">
                            隐藏所选楼层
                        </button>
                    </div>


                </div>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom: 20px;">
                    <div>
                        <label style="color: var(--SmartThemeBodyColor); font-size: 12px;">分段大小(楼/段)</label>
                        <input id="the_ghost_face_control_panel_chunk_size" type="number" min="10" max="100" value="50"
                            class="ghost-input">
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button id="the_ghost_face_control_panel_auto_chunk_summary" class="ghost-button"
                            style="width: 100%;">
                            高楼层总结
                        </button>
                    </div>
                </div>

                <!-- 自定义 API 配置 -->
                <div class="ghost-settings-card">
                    <div style="margin-bottom: 10px;">
                        <div style="font-size: 12px; color: var(--SmartThemeBodyColor);">自定义 API 配置</div>
                    </div>
                    <div id="the_ghost_face_control_panel_custom_api_config" style="display: block;">
                        <div style="margin-bottom: 8px;">
                            <label
                                style="color: var(--SmartThemeBodyColor); font-size: 12px; margin-bottom: 3px; display: block;">
                                API提供商
                            </label>
                            <select id="the_ghost_face_control_panel_custom_api_provider" class="ghost-select"
                                style="font-size: 10px; padding: 4px 6px; width: 100%; margin-bottom: 6px;">
                                <option value="">请选择提供商</option>
                                <option value="https://api.openai.com/v1">OpenAI 官方</option>
                                <option value="https://generativelanguage.googleapis.com/v1beta">Gemini / Google
                                </option>
                                <option value="https://api.deepseek.com/v1">DeepSeek</option>
                                <option value="https://api.x.ai/v1">Grok (xAI)</option>
                                <option value="https://openrouter.ai/api/v1">OpenRouter</option>
                                <option value="custom">✏️ 自定义URL</option>
                            </select>
                            <input id="the_ghost_face_control_panel_custom_api_url" type="text"
                                placeholder="https://your-api-provider.com/v1" class="ghost-input"
                                style="font-size: 10px; padding: 6px 8px; display: none;">
                        </div>

                        <!-- API密钥 -->
                        <div style="margin-bottom: 8px;">
                            <label
                                style="color: var(--SmartThemeBodyColor); font-size: 12px; margin-bottom: 3px; display: block;">
                                API密钥
                            </label>
                            <input id="the_ghost_face_control_panel_custom_api_key" type="password" placeholder="sk-..."
                                class="ghost-input" style="font-size: 10px; padding: 6px 8px;">
                        </div>

                        <!-- 模型选择 -->
                        <div style="margin-bottom: 8px;">
                            <label
                                style="color: var(--SmartThemeBodyColor); font-size: 12px; margin-bottom: 3px; display: block;">
                                模型
                            </label>
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 6px;">
                                <select id="the_ghost_face_control_panel_custom_api_model" class="ghost-select"
                                    style="font-size: 10px; padding: 4px 6px;">
                                    <option value="">请先加载模型</option>
                                </select>
                                <button id="the_ghost_face_control_panel_load_models_button" class="ghost-button"
                                    style="padding: 4px 8px; min-height: 26px; font-size: 12px; white-space: nowrap;">
                                    加载
                                </button>
                            </div>
                        </div>

                        <!-- API状态 -->
                        <div style="margin-bottom: 8px;">
                            <div id="the_ghost_face_control_panel_api_status"
                                style="font-size: 12px; color: #000000; padding: 4px 6px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                                当前状态: 未配置
                            </div>
                        </div>

                        <!-- 保存/清除按钮 -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                            <button id="the_ghost_face_control_panel_save_api_config" class="ghost-button"
                                style="font-size: 12px; min-height: 26px; padding: 4px 6px;">
                                保存
                            </button>
                            <button id="the_ghost_face_control_panel_clear_api_config" class="ghost-button"
                                style="font-size: 12px; min-height: 26px; padding: 4px 6px;">
                                清除
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- 状态信息 -->
            <div class="ghost-status-card">
                <div class="ghost-status-info">
                    <div>Token数: <span id="the_ghost_face_control_panel_message_count">0</span></div>
                    <div>可见消息数: <span id="the_ghost_face_control_panel_msg_counter">0</span></div>
                    <div>状态: <span id="the_ghost_face_control_panel_status_text">自动尾随中</span></div>
                </div>
            </div>

            <!-- Mini Chat Section -->
            <div class="ghost-chat-section">
                <button id="the_ghost_face_chat_toggle" class="ghost-button ghost-chat-toggle">
                    和鬼面媎对话
                </button>
                <div id="the_ghost_face_chat_area" class="ghost-chat-area" style="display: none;">
                    <div id="the_ghost_face_chat_messages" class="ghost-chat-messages">
                        <div class="ghost-chat-welcome">来吧宝贝，有什么是媎可以帮忙的？</div>
                    </div>
                    <div class="ghost-chat-input-bar">
                        <input id="the_ghost_face_chat_input" type="text" class="ghost-input ghost-chat-input"
                            placeholder="输入指令或问题..." />
                        <button id="the_ghost_face_chat_send" class="ghost-button ghost-primary ghost-chat-send-btn">
                            发送
                        </button>
                    </div>
                </div>
            </div>

            <!-- 日志区域 -->
            <div class="ghost-log-section">
                <div class="ghost-log-header">
                    <span class="ghost-log-title">受害者的详细行程</span>
                    <button id="the_ghost_face_control_panel_clear_log" class="ghost-log-clear">清空</button>
                </div>
                <div id="the_ghost_face_progress" class="ghost-progress-section" style="display: none;">
                    <div class="ghost-progress-track">
                        <div id="the_ghost_face_progress_fill" class="ghost-progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="the_ghost_face_progress_text" class="ghost-progress-text">准备中...</div>
                </div>

                <!-- Login/Register Modal REMOVED - Moved to Moments Panel Settings -->
                <div id="the_ghost_face_control_panel_log_content">
                </div>
            </div>
        </div>
    </div>
</div>