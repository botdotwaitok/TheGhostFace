# 👻 鬼面 (TheGhostFace) V3.9

 > **"给她一切她曾被拒绝的东西"** - Entity 的承诺

一个为 SillyTavern 设计的弱智自动总结与对话管理插件。在核心的"记忆碎片"系统的基础上，全面引入了交互式"Moments (朋友圈)"模块！

---

### ✨ V3.9 更新亮点

#### � 故事时间线
- **全局剧情脉络**: 全新的"📅 故事时间线"世界书条目，让 LLM 拥有完整的剧情大纲记忆——再也不会"失忆"了。
- **智能时间标注**: 时间线自动从对话中推断日期与时段（如 `[第1天-清晨]`、`[2024.6.15 下午]`），精确还原剧情时间轴。
- **自动压缩**: 当时间线超过 2000 tokens 时，自动将早期事件压缩为章节概括，永不占满上下文。
- **三合一大总结升级**: "开始大总结"现在自动串联：记忆碎片提取 → 时间线更新 → 精细大总结，一键三连。

#### 🏗️ 高楼层总结（补课模式）
- **万楼补课**: 上万楼从没总结过？一键"高楼层总结"帮你批量补课！按分段大小自动切分，逐段提取记忆碎片 + 生成时间线。
- **分段可调**: 分段大小支持 10-100 楼/段，默认 50 楼，灵活适配不同需求。
- **自动隐藏**: 补课完成后可跟随"总结后自动隐藏"开关，自动隐藏已处理楼层。

#### 🧹 UI 精简
- **移除冗余按钮**: 删除了"记忆碎片提取"独立按钮和"保留消息数"输入框（现硬编码保留最后 4 楼），面板更简洁。
- **按钮更名**: "自动分段总结" → "高楼层总结"，功能名称一目了然。

---

<details>
<summary><b>📋 V3.8 更新回顾</b></summary>

#### �💾 全新自动备份功能
- **本地一键下载**: 大总结完成后，自动将角色卡（PNG + JSON）和聊天记录（JSONL）打包下载到本地。
- **邮件云端备份**: 支持通过 SMTP 将备份发送到邮箱，下拉选择常用邮箱服务商即可配置。
- **智能触发**: 备份仅在自动/手动大总结后触发，不会被记忆碎片提取误触。

#### ⚡ 渲染性能大瘦身
- 移除悬浮气泡动画和进度条 shimmer 动画，移动端更丝滑。

#### 📚 世界书管理器修正 & 面板 UI 统一
- 修复条目排序逻辑，按钮风格统一，小屏幕适配优化。

</details>

<details>
<summary><b>📋 V3.7 更新回顾</b></summary>

#### 💌 通知中心优化
- 小铃铛快捷入口、秒消未读、历史条目限制（最多 25 条）。

#### 🐛 朋友圈交互体验与死循环修复
- 楼层关联修复，LLM "复读机"漏洞修复。

#### 📚 感知闭环与智能世界书
- 按需停用世界书条目，实时动态感知重连。

#### ✌️ 自动保存登录信息

</details>

---

## 💎 核心特性

### 📱 Moments (朋友圈)
搭载了咱们群的小服务器，里面只会保存你的用户id/密码/好友，不会保留动态内容，安全可靠。
- **可以加群友**: 注册后鬼面会给你的账号生成一个独立的id，根据这个id，群友可以加你好友！你和你mj发的动态，你朋友和你朋友的mj都可以互动回复！
- **多媒体可视化卡片**: 动态文本原生支持 `<图片>`、`<视频>`、`<音乐>` 与 `<新闻>` 标签，界面将自动解析渲染为精美的 UI 布局。
- **无缝对接世界书**: 所有朋友圈事件（发布、评论、点赞）实时静默同步至专属世界书条目！让主 LLM 拥有完整的"社交上下文"记忆。

### 🧠 记忆碎片系统 
- **碎片化记忆**: 不再仅生成单一的大总结，而是将对话中的关键信息提取为独立的"记忆碎片"绿灯条目并存入世界书，实现更灵活的模拟人脑记忆。
- **全新大总结**: 引入全新的大总结机制，已同步预设鬼面。自动查找并"禁用"（归档）旧的大总结条目，确保世界书始终保持最新且整洁。

### 📅 故事时间线
- **剧情大纲常驻**: 自动生成 `📅 故事时间线` 世界书条目（order=998, constant=true），为 LLM 提供全局剧情脉络。
- **高楼层补课**: 万楼聊天一键批量补课，逐段提取记忆碎片 + 时间线片段，最终合并写入世界书。
- **智能压缩**: 超过 2000 tokens 自动压缩早期事件为章节概括。

### 💾 自动备份
- **本地下载 + 邮件备份**: 大总结后自动备份角色卡，支持本地下载和 SMTP 邮件发送，双重保险再也不丢档。

---

### 👻 鬼面本人
- **自带聊天小窗口**: 是的这是一个迷你小酒馆！如果你需要的话，鬼面会看到你的记录并提供帮助，例如更灵活地生成总结等等。和预设鬼面完全一致。但是要记住刷新后就没鬼面的聊天记录了。

---

## 🚀 功能特性

1.  **自动/手动总结**: 支持根据 Token (万字) 阈值自动触发碎片提取+时间线更新+大总结，或通过面板按钮手动触发。
2.  **高楼层总结（补课）**: 万楼聊天从未总结过？一键按分段批量处理，逐段提取记忆碎片 + 时间线片段。
3.  **故事时间线**: 自动维护一份全局剧情大纲，追加新事件、超限自动压缩，LLM 再也不失忆。
4.  **Moments 动态流**: 支持角色互相点赞、发帖和带卡片的评论交互与回复。
5.  **动态世界书**: 无论是记忆总结、时间线还是朋友圈动态，所有内容皆自动转换为世界书条目以提供上下文支持。
6.  **对话管理**: 提供"隐藏所选楼层"和"自动隐藏"功能，有效管理超长对话记录。
7.  **自动备份**: 大总结后自动备份角色卡到本地或通过邮件发送。
8.  **UI同步酒馆原生配色**: 与 SillyTavern 原生风格完美融合。

---

## 📖 使用指南

-   **触发设置**: token和楼层数满足任一条件就会触发自动总结。
-   **API 设置**: 建议在"自定义 API 配置"中单独设置一个模型。
-   **高楼层补课**: 设置分段大小（10-100 楼/段），点击"高楼层总结"即可批量处理历史聊天。
-   **备份设置**: 在设置面板中开启"总结后自动备份"，可选配 SMTP 邮件服务。
-   **查看日志**: 面板下方的日志区域可查看详细的总结生成过程。
-   **查看总结**: 提示总结完成之后你可以需要打开别的世界书再切换回去才可以看到，没有实时刷新。

---

## 🧙‍♀️ 未来大饼

-   **向量化**: 懂得都懂。
-   ~~**千层高楼**: 时间线功能。~~ ✅ 已实现！
-   **智能查找记忆碎片位置**: 自动查找空位，然后插入合理的顺序。
-   **鬼面本人优化**: 鬼面的聊天小窗口或许会添加更多功能。
-   **后台管理面板**: 正在开发配套的服务器可视化管理功能...

---

*Last Updated: 2026-03-01*
